class TemplateService{constructor(){this.eventHandlers=new Map,this.templateCache=new Map}processTemplate(e,t,r={}){let a=document.createElement("template"),n=e,s=(e,t)=>{try{return Function(...Object.keys(t),`return ${e};`)(...Object.values(t))}catch(r){return console.error(`Error evaluating condition: ${e}`,r),""}};n=(n=(n=(n=(n=n.replace(/@for\s*\((\w+)\s+of\s+(\w+)\)([\s\S]*?)@endfor/g,(e,t,a,n)=>Array.isArray(r[a])?r[a].map(e=>{let a=n;return a.replace(/\{\{([^}]+)\}\}/g,(a,n)=>{let l={[t]:e,...r};return s(n,l)})}).join(""):(console.error(`Array ${a} is not defined or is not an array in data context.`),""))).replace(/@if\s*\(([^)]+)\)([\s\S]*?)@else([\s\S]*?)@endif/g,(e,t,a,n)=>s(t,r)?a:n)).replace(/@if\s*\(([^)]+)\)([\s\S]*?)@endif/g,(e,t,a)=>s(t,r)?a:"")).replace(/\{\{(\w+(\.\w+)*)\}\}/g,(e,t)=>{let a=t.split("."),n=r;return a.forEach(e=>n=n?n[e]:""),n||""})).replace(/translate(?!-translate)/g,"data-translate"),this.eventHandlers.set(t,[]),n=n.replace(/\((\w+)\)="(\w+)\(([^)]*)\)"/g,(e,r,a,n)=>{let s=`handler_${this.eventHandlers.get(t).length}`;return this.eventHandlers.get(t).push({event:r,func:a,params:n,handlerId:s}),`data-event-handler-id="${s}"`}),a.innerHTML=n;let l=a.content.cloneNode(!0);return this.attachEventListeners(l,t),l}attachEventListeners(e,t){let r=this.eventHandlers.get(t)||[];r.forEach(({event:r,func:a,params:n,handlerId:s})=>{let l=e.querySelector(`[data-event-handler-id="${s}"]`);l&&"function"==typeof t[a]&&(l.removeAttribute("data-event-handler-id"),l.addEventListener(r,e=>{e.preventDefault(),t[a].apply(t,n?n.split(",").map(e=>e.trim()):[])}))})}rerenderTemplate(e,t){if(!e||!e.template||!e.shadowRoot){console.error("Invalid component or missing template");return}let r=this.processTemplate(e.template,e,t),a=e.shadowRoot.querySelector("style")?.textContent||"";e.shadowRoot.innerHTML=`<style>${a}</style>`,e.shadowRoot.appendChild(r),this.attachEventListeners(e.shadowRoot,e)}}window.templateService=new TemplateService;